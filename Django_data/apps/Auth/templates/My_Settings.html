<html lang="en">
{% load static %}
{% include "Home/head.html" %}

<body>
  {% include "Home/header.html" %}
  {% include "Profile/Profile.html" %}
  <div id="content">
    <div id="titleContent" data-content="SETTINGS"></div>
    <div id="overlayFullscreen">
      <img id="BackArrowFullscreen" src="{% static 'images/Arrow.png' %}" alt="Shitty back arrow"></img>
      <div class="midFullscreen midrow">
        <div id="section">
          <div id="headerTextRow">
            <h1 id="settingsTitle">Settings</h1>
            <p id="settingsText">Here you can manage and update your account details, display name and profile picture</p>
          </div>
        </div>
        <div id="section">
          <div id="leftcolumn">
            <div id="Settings">
              <button class="SectionLayout SectionGrey">Account Settings</button>
              <form id="NAME_Form" action="" method='post'>
                {% csrf_token %}
                  <div class="field-container">
                    {{ name.as_p }}
                    <button class="UpdateButtonLayout ButtonDark" type="submit" name="name_button">Update</button>
                  </div>
               </form>
               <form id="MAIL_Form" action="" method='post'>
                 {% csrf_token %}
                  <div class="field-container">
                    {{ mail.as_p }}
                    <button class="UpdateButtonLayout ButtonDark" type="submit" name="mail_button">Update</button>
                  </div>
              </form>
              <form id="PASS_Form" action="" method='post' name="pswd_button">
                 {% csrf_token %}
                  <div class="field-container">
                    {{ pswd.as_p }}
                    <button class="UpdateButtonLayout ButtonDark" type="submit" name="pswd_button">Update</button>
                  </div>
              </form>
            </div>
          </div>
          <div id="rightcolumn">
            <div id="titleContent" data-content="PROFILE_PAGE"></div>
            <div id="Settings">
              <button class="SectionLayout SectionGrey">Display Settings</button>
              <form id="NAME_Form" action="" method='post'>
                {% csrf_token %}
                  <div class="field-container">
                    {{ name.as_p }}
                    <button class="UpdateButtonLayout ButtonDark" type="submit" name="name_button">Update</button>
                  </div>
               </form>
               <form id="AVATAR_Form" action="" method='post' enctype="multipart/form-data">
                 {% csrf_token %}
                 {{ avatar.as_p }}
                <img class="ProfilePic modal-profilePic" src="{{ user.avatar.url }}"></img>
                <!-- Le bouton ci dessous est caché et set juste à référencer le submit du formulaire -->
                <button class="UpdateButtonLayout ButtonDark" type="submit" id='avatar_button_hidden'>Update</button>
              </form>
              <div id="DoubleButton">
                <button id="AVATAR_Change" class="MediumButtonLayout left ButtonNeon">Change</button>
                <button id="AVATAR_Delete" class="MediumButtonLayout right ButtonNeon">Delete</button>
              </div>
            </div>
          </div>
			  </div>
		  </div>
	  </div>
    <div id="overlayMobile">
      <div class="midMobile midcolumn">
        <div id="titleContent" data-content="SIGNUP_PAGE"></div>
        <img id="BackArrowMobile" src="{% static 'images/Arrow.png' %}" alt="Shitty back arrow"></img>
        <div id="headerTextRowMobile">
          <h1 id="settingsTitle">Settings</h1>
          <p id="settingsText">Here you can manage and update your account details, display name and profile picture</p>
        </div>
        <form action="" method='post' enctype="multipart/form-data">
          {% csrf_token %}
          {% comment %} <img src="{{ user.avatar.url }}"></img> {% endcomment %}
          {{ avatar.as_p }}
          <button type="submit" name='avatar_button'>Update Avatar</button>
        </form>
      </div>
    </div>
    {% include "Home/footer.html" %}
  </body>

</html>


<!-- Modal -->
<div class="modal fade" id="AvatarModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
		<div class="modal-header">
			  <img id="AvatarBackArrow" src="{% static 'images/Arrow.png' %}" alt="Shitty back arrow"></img>
		</div>
		<div class="modal-body">
      <div id="ModalContent" data-content="AVATAR_CHANGE"></div>
      <!--Avatar-->
      <div>
        <div class="d-flex justify-content-center mb-4">
            <img id="selectedAvatar" src="https://mdbootstrap.com/img/Photos/Others/placeholder-avatar.jpg"
            class="rounded-circle" style="width: 200px; height: 200px; object-fit: cover;" alt="example placeholder" />
        </div>
        <div class="d-flex justify-content-center">
          <button type="button" id="customFileButton" class="SelectButtonLayout ButtonNeon">Choisir un fichier</button>
          <button class="UpdateButtonLayout ButtonDark" type="submit" id="submitAvatar">Update</button>
        </div>
      </div>
		</div>
		<div class="modal-footer">
		</div>
		</div>
	</div>
</div>

  
<script>
  // Fonction pour déclencher le sélecteur de fichiers
  document.getElementById('customFileButton').addEventListener('click', function() {
      document.getElementById('id_avatar').click();
  });
    
  // Fonction pour afficher l'image sélectionnée
  function displaySelectedImage(event) 
  {
       const fileInput = event.target;
       const selectedImage = document.getElementById('selectedAvatar');
       
       if (fileInput.files && fileInput.files[0]) 
       {
           const reader = new FileReader();   
           reader.onload = function(e) {
               selectedImage.src = e.target.result;
           };     
           reader.readAsDataURL(fileInput.files[0]);
       }
  }

  // Target la soumission de formulaire
  document.getElementById('submitAvatar').addEventListener('click', function() {
        document.getElementById('AVATAR_Form').submit();
    });
   
  // Ajoute un écouteur d'événements 'change' à l'input 'id_avatar'
  document.getElementById('id_avatar').addEventListener('change', displaySelectedImage);

  // Cherche et cache certains mots non-balisés
  document.addEventListener('DOMContentLoaded', function() {
    var paragraph = document.querySelector('#AVATAR_Form p');
    var textNodes = paragraph.childNodes;
    for (var i = 0; i < textNodes.length; i++) 
    {
      var node = textNodes[i];
      if (node.nodeType === Node.TEXT_NODE) 
      {
        if (node.textContent.includes('Change:') || node.textContent.includes('Currently:')) 
        {
          // Enrobe le texte dans une balise span pour le cacher
          var span = document.createElement('span');
          span.className = 'hide-element';
          span.textContent = node.textContent;
          paragraph.replaceChild(span, node);
        }
      }
    }
  });

</script>